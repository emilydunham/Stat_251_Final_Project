---
title: "Comparing Test Scores Between Boys and Girls"
format: pdf
author: Adam Bitner, Emily Dunham, Sammy Hilton
---
# Introduction
We are interested to see the difference mean score on some test scores between boys and girls. Do girls naturally do better in some subjects than men? Do mean do better in other subjects than girls? We aim to answer this question. This analysis is helpful because it can help teachers better understand who could be predisposed to struggle more in the class. Furthermore this can help universities and educators to understand effects of different teaching methods and give a better base line for expected performance. The American Psychology association has published an analysis claiming that girls do better than boys in school in essentially all subjects, we will be testing the validity of that claim.

```{r, echo = FALSE}
# Loading dataset/packages
StudentsPerformance <- read.csv("~/Documents/BYU/Fall 2025 Semester/Stat 251/StudentsPerformance.csv")
library(invgamma)
```

# Methods
## Getting our Likelihood and Priors
The relevant parameters for our likelihood that we chose would be from a normal distribution. Since we believe that grades on a test will behave in a distribution that is likely to look more normal where most students will do generally well and only a few will get really high scores and a few will get very low scores. This will be useful in answering our question because we know that for most students this will generally be the pattern. For our prior distribution we decided that our priors for both boys and girls will be the same. However we still need two priors, one for the mean and one for the standard deviation of our likelihood.
$$\text{Likelihood} = \text{N}\sim(\mu, \sigma^2)$$

For the mean we chose a normal prior with $\mu = 80$ because we believe that most students will average around 80. We chose $\sigma^2 = 5$ because we believe that our guess about the mean being 80 might be off by around 5 points.
$$\mu = \text{N}\sim(80, 5^2)$$

For the standard deviation we chose an inverse gamma prior. In order to find what our $a$ and $b$ values would be we chose what we expected the value of $\sigma^2$ would be for our likelihood and what we thought the standard deviation of that would be. In our case we chose the mean and standard deviation to be 10 and 4 respectively. Then using method of moments we took those values and calculated $a$ and $b$. From our results we got that $a = 3.6$ and $b = 256.3$.
$$\sigma^2 = \text{IG}\sim(3.6, 256)$$
```{r, echo = FALSE}
# We will just use the same prior for both boys and girls

# Prior
# We need a mean prior and a variance prior
# mean prior will be a Normal distribution
# variance prior will be a Inverse Gamma distribution

# Prior (Mean)
# we think that the mean will be around 80 for an overall test score
# we think that or mean about the mean will be off by around 5pts

# Prior (Variance)
# We will use a method of moments to get the inverse gamma a and b values
# We will use this function to get our a and b values. We do this by giving it 
# our beliefs about sigma. 
ig_from_sigma_mom <- function(mean_sigma, sd_sigma) {
  stopifnot(mean_sigma > 0, sd_sigma > 0)
  mean_var <- mean_sigma^2
  sd_var <- 2 * mean_sigma * sd_sigma
  a <- 2 + (mean_var^2)/(sd_var^2)
  b <- mean_var * (a - 1)
  list(a = a, b = b)
}
a_and_b <- ig_from_sigma_mom(mean_sigma = 10, sd_sigma = 4) 
# we think that our sigma will be around 10 and that we will be off by about 4
```

# Results
## Posterior for Math Test Scores
```{r, echo = FALSE, include = FALSE}
## Boys Math Scores:
# Priors
m <- 80; v <- 5^2 # mu ~ N(m,v)
a <- 3.6; b <- 256 # sigma^2 ~ IG(a, b)
y_male_math <- StudentsPerformance$math.score[StudentsPerformance$gender == "male"]

update.mu <- function(sigma2,ys,m,v){
  n <- length(ys)
  vstar = 1/(n/sigma2 + 1/v)
  ybar <- mean(ys)
  mstar = vstar * (n*ybar/sigma2 + m/v)
  rnorm(1, mstar, sqrt(vstar))
}

update.var <- function(mu,ys,a,b){
  n <- length(ys)
  astar <- a + n/2
  bstar <- b + 0.5*sum((ys-mu)^2)
  rinvgamma(1, astar, bstar) 
}

# We need to do the Gibbs sampling in order to find the posterior
J <- 1000
mu <- rep(NA, J + 1)
sigma2 <- rep(NA, J + 1)

# Step 0:
mu[1] <- mean(y_male_math)
sigma2[1] <- var(y_male_math)

# Step 1:
for (j in 2:(J+1)){
  mu[j] <- update.mu(sigma2 = sigma2[j-1], ys = y_male_math, m = m, v = v)
  sigma2[j] <- update.var(mu = mu[j], ys = y_male_math, a = a, b = b)
}

# Step 2:
# Trace plot of the mu draws
p1 <- plot(mu, type="l", ylab=expression(mu),
     main=expression(paste("Trace plot for ",mu, " of boys math scores")))
# Trace plot of the sigma2 draws
p2 <- plot(sigma2, type="l", ylab=expression(sigma^2),
     main=expression(paste("Trace plot for ",sigma^2, " of boys math scores")))

# Get the means
boys_math_mu <- mean(mu[-c(1:50)]) #taking off a bit of burn in
boys_math_var <- mean(sigma2[-c(1:50)]) # this is my variance
boys_math_sd <- sqrt(mean(sigma2[-c(1:50)])) # this is my standard deviation
# So for boys math scores we have a mean of 69 and a standard deviation of 14.3
```
```{r, echo = FALSE, include = FALSE}
## Girls Math Scores:
# Priors
m <- 80; v <- 5^2 # mu ~ N(m,v)
a <- 3.6; b <- 256 # sigma^2 ~ IG(a, b)
y_female_math <- StudentsPerformance$math.score[StudentsPerformance$gender == "female"]


# We need to do the Gibbs sampling in order to find the posterior
J <- 1000
mu <- rep(NA, J + 1)
sigma2 <- rep(NA, J + 1)

# Step 0:
mu[1] <- mean(y_female_math)
sigma2[1] <- var(y_female_math)

# Step 1:
for (j in 2:(J+1)){
  mu[j] <- update.mu(sigma2 = sigma2[j-1], ys = y_female_math, m = m, v = v)
  sigma2[j] <- update.var(mu = mu[j], ys = y_female_math, a = a, b = b)
}

# Step 2:
# Trace plot of the mu draws
p3 <- plot(mu, type="l", ylab=expression(mu),
     main=expression(paste("Trace plot for ",mu, " of girls math scores")))
# Trace plot of the sigma2 draws
p4 <- plot(sigma2, type="l", ylab=expression(sigma^2),
     main=expression(paste("Trace plot for ",sigma^2, " of girls math scores")))

# Get the means
girls_math_mu <- mean(mu[-c(1:50)]) #taking off a bit of burn in
girls_math_var <- mean(sigma2[-c(1:50)]) # this is my variance
girls_math_sd <- sqrt(mean(sigma2[-c(1:50)])) # this is my standard deviation
# So for boys math scores we have a mean of 64 and a standard deviation of 15.4
```

```{r, echo = FALSE}
# Comparing the difference using Monte Carlo
set.seed(1)

# Posterior
samples_b <- rnorm(10000, boys_math_mu, boys_math_sd)
samples_g <- rnorm(10000, girls_math_mu, girls_math_sd)

diffs <- samples_b - samples_g

CI <- quantile(diffs, c(.025, .975))

mean_math_diffs <- mean(diffs)

# Prior
m <- 80
v <- 5^2
a <- 3.6
b <- 256

# Number of prior samples
N <- 10000

# Draw prior mus
prior_mu_b <- rnorm(N, m, sqrt(v))
prior_mu_g <- rnorm(N, m, sqrt(v))

# Draw prior variances
prior_sigma2_b <- rinvgamma(N, a, b)
prior_sigma2_g <- rinvgamma(N, a, b)

# Convert variances to sds
prior_sd_b <- sqrt(prior_sigma2_b)
prior_sd_g <- sqrt(prior_sigma2_g)

# Draw prior predictive observations of the means
prior_samples_b <- rnorm(N, prior_mu_b, prior_sd_b)
prior_samples_g <- rnorm(N, prior_mu_g, prior_sd_g)

prior_diffs <- prior_samples_b - prior_samples_g

# Plot them together
plot(density(prior_diffs), 
     main="Posterior of Boys - Girls Mean Difference \n in Math Scores",
     xlab="Difference",
     col = "red")
lines(density(diffs))
legend("topright",                     
       legend = c("Prior", "Posterior"), 
       col = c("red", "black"),   
       lwd = 2)

```
Based on our posterior we are 95% sure that the difference between boys and girls math scores is between -37 and 46 points. Since 0 is in our interval we cannot conclude that boys are better at math then girls because there is a chance that there is no difference in their test scores.

## Posterior for Writing Test Scores

## Posterior for Reading Test Scores


